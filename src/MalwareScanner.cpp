#include <iostream>
#include "MalwareScanner.h"

ScanResult MalwareScanner::scanDirectory(const std::filesystem::path &path) {
    ScanResult result{};
    auto start_time = std::chrono::high_resolution_clock::now();

    if (!is_directory(path)) {
        std::cout << "Eblan?";
        throw std::invalid_argument("Path is not directory");
    }

    for (const auto &entry: std::filesystem::directory_iterator(path)) {
        std::cout << "Scanning: " << entry.path() << std::endl;
        auto file_res = parser_.processFile(entry.path());
        result.loadParseResult(file_res);
    }

    auto stop_time = std::chrono::high_resolution_clock::now();
    auto duration_time = std::chrono::duration_cast<std::chrono::milliseconds>(stop_time - start_time);
    result.setExecutionTime(duration_time);

    return result;
}
